# React のパフォーマンス計測

## React.memo のパフォーマンス計測

- メモ化しないコンポーネントをレンダリングするコストを計測
- App 配下に 大量の Item コンポーネントを呼び出しレンダリングをする
- Item コンポーネントをメモ化した場合と、メモ化しない場合のレンダリング時間（Profiler の ActualTime）を計測
- 計測には Profile API を使用

| Item コンポーネントの数 | Duration（メモ化なし） | Duration（メモ化あり） |
| ----------------------- | ---------------------- | ---------------------- |
| 10000 個                | 266ms                  | 68ms                   |
| 5000 個                 | 122ms                  | 37ms                   |
| 1000 個                 | 30ms                   | 10ms                   |
| 100 個                  | 10ms                   | 3ms                    |
| 10 個                   | 2ms                    | 1.1ms                  |

## 考察

- 10000 個もあるコンポーネントをメモ化せずに再描画すると、パフォーマンスにかなり影響が出てくる
- [MDN](https://developer.mozilla.org/en-US/docs/Web/Performance/How_long_is_too_long)に書かれてあるように、ユーザー入力のよるフィードバック速度は 50ms 以内を目指すべきだが、10000 個, 5000 個の場合は 100ms 以上掛かっている
- ただ、100 個や 10 個の場合は、メモ化してもしなくても全く影響のない時間でフィードバックを返している
- 今回は単純化したコンポーネントの計測だったため、コンポーネントの構造などによって大きく計測結果は変わる
- 実運用でも今回のように毎回計測してもよいが、毎回計測するのはかなりやりすぎ感はあるので、フィードバックが遅いと感じる部分に対して実際に計測して、メモ化をするかの判断をしてもいいと思う（100ms の場合は確かに体感としてかなり遅いと感じる）
